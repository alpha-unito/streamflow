============
Installation
============

.. meta::
   :keywords: StreamFlow, installation, pip, docker, kubernetes, helm, setup
   :description: Complete guide for installing StreamFlow via pip, Docker, or Kubernetes with Helm

Overview
========

StreamFlow can be installed in multiple ways depending on your environment and use case. This guide covers all installation methods with verification steps and troubleshooting guidance.

Installation Methods
====================

.. note::

   **Supported Platforms:** StreamFlow supports Linux and macOS only. Windows is not supported.

========================  ===============================  =============================
Method                    Best For                         Prerequisites
========================  ===============================  =============================
:ref:`install-pip`        Most users, development          Python 3.10-3.14
:ref:`install-docker`     Containerized environments       Docker
:ref:`install-k8s`        Production deployments           Kubernetes cluster, Helm
========================  ===============================  =============================

.. _install-pip:

Method 1: Install with pip
===========================

The StreamFlow module is available on `PyPI <https://pypi.org/project/streamflow/>`_ and can be installed using pip. This is the recommended method for most users.

Prerequisites
-------------

* Python 3.10, 3.11, 3.12, 3.13, or 3.14
* pip (Python package installer)

Installation Command
--------------------

.. code-block:: bash
   :caption: Install StreamFlow from PyPI

   pip install streamflow

For the latest development version from GitHub:

.. code-block:: bash
   :caption: Install from GitHub main branch

   pip install git+https://github.com/alpha-unito/streamflow.git

Verify Installation
-------------------

Check that StreamFlow is installed correctly:

.. code-block:: bash

   $ streamflow version

   StreamFlow version 0.2.0.dev14

Check available commands:

.. code-block:: bash

   $ streamflow --help

   usage: streamflow [-h] {ext,list,plugin,prov,report,run,schema,version} ...

   StreamFlow Command Line

   positional arguments:
     {ext,list,plugin,prov,report,run,schema,version}
       ext                 Retrieve information on the available StreamFlow extensions
       list                List the executed workflows
       plugin              Retrieve information on the installed StreamFlow plugins
       prov                Generate a provenance archive for an executed workflow
       report              Generate a report for an executed workflow
       run                 Execute a workflow
       schema              Dump StreamFlow JSON Schema and exit
       version             Only print StreamFlow version and exit

Run Your First Workflow
-----------------------

After installation, you can execute workflows using the StreamFlow CLI:

.. code-block:: bash
   :caption: Execute a workflow

   streamflow run /path/to/streamflow.yml

For a complete first workflow example, see the :doc:`quickstart` guide.

Upgrading
---------

To upgrade to the latest version:

.. code-block:: bash
   :caption: Upgrade StreamFlow

   pip install --upgrade streamflow

Uninstalling
------------

To remove StreamFlow:

.. code-block:: bash
   :caption: Uninstall StreamFlow

   pip uninstall streamflow

.. _install-docker:

Method 2: Run with Docker
==========================

StreamFlow Docker images are available on `Docker Hub <https://hub.docker.com/r/alphaunito/streamflow>`_. This method is ideal for containerized environments or testing StreamFlow without installing Python dependencies.

Prerequisites
-------------

* Docker Engine (version 20.10 or later recommended)
* Docker daemon running

Pull the Image
--------------

Download the latest StreamFlow Docker image:

.. code-block:: bash
   :caption: Pull latest StreamFlow image

   docker pull --platform linux/amd64 alphaunito/streamflow:latest

For a specific development version:

.. code-block:: bash
   :caption: Pull specific development version

   docker pull --platform linux/amd64 alphaunito/streamflow:0.2.0.dev14

.. note::

   **Platform Limitation:** The Docker images are built for ``linux/amd64`` platform only.
   
   * **Apple Silicon / ARM64:** Use ``docker pull --platform linux/amd64 alphaunito/streamflow:latest`` or install from source with :ref:`install-source`
   * **Available tags:** See `Docker Hub tags <https://hub.docker.com/r/alphaunito/streamflow/tags>`_ for all versions (stable releases use version tags like ``latest``, development versions use ``0.2.0.devN``)

Verify Image
------------

List downloaded images:

.. code-block:: bash

   $ docker images | grep streamflow

   alphaunito/streamflow   latest    abc123def456   2 days ago   500MB

Run StreamFlow in Container
----------------------------

Execute StreamFlow commands in a container:

.. code-block:: bash
   :caption: Run StreamFlow in Docker container

   docker run --rm --platform linux/amd64 alphaunito/streamflow:latest streamflow version

To run a workflow, mount your workflow directory:

.. code-block:: bash
   :caption: Execute workflow with Docker

   docker run --rm --platform linux/amd64 \
     --mount type=bind,source="$(pwd)"/my-project,target=/streamflow/project \
     --mount type=bind,source="$(pwd)"/results,target=/streamflow/results \
     alphaunito/streamflow:latest \
     streamflow run /streamflow/project/streamflow.yml

Docker Compose Example
----------------------

For persistent setups, use Docker Compose:

.. code-block:: yaml
   :caption: docker-compose.yml

   version: '3.8'
   services:
     streamflow:
       image: alphaunito/streamflow:latest
       volumes:
         - ./my-project:/streamflow/project
         - ./results:/streamflow/results
       command: streamflow run /streamflow/project/streamflow.yml

Run with Docker Compose:

.. code-block:: bash
   :caption: Start with Docker Compose

   docker-compose up

.. _install-k8s:

Method 3: Deploy on Kubernetes with Helm
=========================================

For production deployments, StreamFlow can be deployed on Kubernetes using Helm charts.

Prerequisites
-------------

* Kubernetes cluster (1.19 or later)
* kubectl configured to access your cluster
* Helm 3.x installed

Verify Prerequisites
--------------------

.. code-block:: bash
   :caption: Check Kubernetes connection

   kubectl cluster-info

.. code-block:: bash
   :caption: Check Helm installation

   helm version

Using the Helm Chart
---------------------

StreamFlow provides a Helm chart template in the ``helm/chart`` directory of the repository. You can use this template to deploy StreamFlow as a Kubernetes Job.

Clone the repository to access the Helm chart:

.. code-block:: bash
   :caption: Clone StreamFlow repository

   git clone https://github.com/alpha-unito/streamflow.git
   cd streamflow/helm/chart

Install StreamFlow using the local chart:

.. code-block:: bash
   :caption: Install StreamFlow with Helm

   helm install my-streamflow .

With custom values:

.. code-block:: bash
   :caption: Install with custom configuration

   helm install my-streamflow . -f custom-values.yaml

Verify Deployment
-----------------

Check that StreamFlow pods are running:

.. code-block:: bash

   $ kubectl get pods -l app=streamflow

   NAME                         READY   STATUS    RESTARTS   AGE
   my-streamflow-xxxxx          1/1     Running   0          2m

Uninstall
---------

To remove the StreamFlow deployment:

.. code-block:: bash
   :caption: Uninstall StreamFlow from Kubernetes

   helm uninstall my-streamflow

Optional Dependencies
=====================

StreamFlow supports optional features that require additional dependencies.

Container Runtimes
------------------

For container-based workflows, install the appropriate runtime:

**Docker**
   Already covered in :ref:`install-docker`

**Singularity/Apptainer**
   Follow official installation at https://apptainer.org/docs/user/latest/quick_start.html

**Podman**
   Follow official installation at https://podman.io/getting-started/installation

SSH and Remote Execution
-------------------------

For SSH-based connectors, ensure OpenSSH client is installed:

.. code-block:: bash
   :caption: Check SSH installation (Linux/macOS)

   ssh -V

.. code-block:: bash
   :caption: Install OpenSSH (Ubuntu/Debian)

   sudo apt-get install openssh-client

.. code-block:: bash
   :caption: Install OpenSSH (macOS with Homebrew)

   brew install openssh

HPC Schedulers
--------------

StreamFlow supports various HPC schedulers. No client installation is typically required as StreamFlow communicates via SSH, but ensure your HPC system has:

* Slurm, PBS, or other supported scheduler
* SSH access configured
* Appropriate user permissions

Troubleshooting
===============

Python Version Issues
---------------------

**Problem:** ``ERROR: Package requires a different Python version``

**Solution:** Verify Python version:

.. code-block:: bash

   python --version
   # or
   python3 --version

StreamFlow requires Python 3.10 or later. If your default Python is older:

.. code-block:: bash

   # Use Python 3.10+ explicitly
   pip3.10 install streamflow
   # or
   python3.10 -m pip install streamflow

**Problem:** ``Command 'streamflow' not found``

**Solution:** The pip installation directory may not be in your PATH:

.. code-block:: bash

   # Find where streamflow was installed
   pip show streamflow

   # Add to PATH (add to ~/.bashrc or ~/.zshrc for persistence)
   export PATH="$HOME/.local/bin:$PATH"

   # Or use full path
   ~/.local/bin/streamflow version

Docker Issues
-------------

**Problem:** ``docker: Cannot connect to the Docker daemon``

**Solution:** Ensure Docker daemon is running:

.. code-block:: bash

   # Check Docker status
   docker info

   # Start Docker daemon (Linux systemd)
   sudo systemctl start docker

   # macOS: Start Docker Desktop application

**Problem:** Permission denied when running Docker

**Solution:** Add user to docker group (Linux):

.. code-block:: bash

   sudo usermod -aG docker $USER
   # Log out and back in for changes to take effect

Kubernetes/Helm Issues
-----------------------

**Problem:** Helm chart not found in repository

**Solution:** Clone the StreamFlow repository to access the Helm chart:

.. code-block:: bash

   git clone https://github.com/alpha-unito/streamflow.git
   cd streamflow/helm/chart

**Problem:** Pods stuck in ``Pending`` state

**Solution:** Check resource availability and pod events:

.. code-block:: bash

   kubectl describe pod <pod-name>
   kubectl get events --sort-by='.lastTimestamp'

Dependency Conflicts
--------------------

**Problem:** pip reports dependency conflicts during installation

**Solution:** Use a virtual environment to isolate dependencies:

.. code-block:: bash

   # Create virtual environment
   python3 -m venv streamflow-env

   # Activate virtual environment
   source streamflow-env/bin/activate  # Linux/macOS

   # Install StreamFlow
   pip install streamflow

Installation Hangs
------------------

**Problem:** pip installation hangs or is very slow

**Solution:** Try using a different PyPI mirror or increase timeout:

.. code-block:: bash

   # Increase timeout
   pip install --timeout=300 streamflow

   # Use verbose output to see progress
   pip install -v streamflow

Performance Issues
------------------

**Problem:** StreamFlow runs slowly or uses excessive resources

**Solution:** Check system resources and adjust configuration:

.. code-block:: bash

   # Check available resources
   free -h  # Linux
   top      # Monitor processes

   # Adjust StreamFlow configuration (streamflow.yml)
   # Set appropriate resource limits in deployment configuration

Getting Help
------------

If you encounter issues not covered here:

1. **Check logs:** StreamFlow logs provide detailed error information
2. **Search issues:** Visit https://github.com/alpha-unito/streamflow/issues
3. **Ask questions:** Use GitHub Discussions
4. **Report bugs:** Open a new issue with:
   
   * StreamFlow version (``streamflow version``)
   * Python version (``python --version``)
   * Operating system
   * Complete error message
   * Minimal reproducible example

Next Steps
==========

After installing StreamFlow, continue with:

* :doc:`quickstart` - Run your first workflow in 10 minutes
* :doc:`writing-workflows` - Learn CWL workflow syntax
* :doc:`configuring-deployments` - Set up execution environments
* :ref:`/reference/configuration/index` - Detailed configuration reference

Related Topics
==============

* :doc:`/reference/cli/index` - Complete CLI command reference
* :doc:`/reference/configuration/index` - Configuration file schemas
* :doc:`/reference/connectors/index` - Available deployment connectors
* :doc:`troubleshooting` - Common issues and solutions
